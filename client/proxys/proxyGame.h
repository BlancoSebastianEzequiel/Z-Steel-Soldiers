// "Copyright [2017] <Copyright SebastianBlanco>"
//------------------------------------------------------------------------------
#ifndef PROXY_GAME_H
#define PROXY_GAME_H
//------------------------------------------------------------------------------
class ProxyNode;
class ProxyUnit;
class ProxyObject;
class ProxyTerritories;
class ProxyMunition;
class Communicator;
//------------------------------------------------------------------------------
#include <cstddef>
#include <queue>
#include <string>
#include <vector>
#include <cstdint>
#include <stdint-gcc.h>
#include <mutex>
#include "../../libs/Dicc.h"
#include "../../libs/Parser.h"
#include "../interpreters/interpreter.h"
#include "../../libs/Queue.h"
//------------------------------------------------------------------------------
typedef Dicc<size_t , ProxyUnit*> proxyUnitsMap;
typedef Dicc<size_t , ProxyObject*> proxyObjectsMap;
typedef Dicc<size_t , ProxyMunition*> proxyMunitionMap;
typedef  Dicc<size_t , ProxyTerritories*> proxyTerritoriesMap;
typedef std::vector<std::string> parsedModel_t;
typedef Queue<std::string> petitions_t;
//------------------------------------------------------------------------------
class ProxyGame {
 public :
    std::vector<std::vector<ProxyNode*>> gameMap;
    uint32_t width;
    uint32_t height;
 private :
    Queue<std::string>& petitions;
    Interpreter interpreter;
    proxyUnitsMap units;
    proxyObjectsMap objects;
    proxyTerritoriesMap proxyTerritories;
    proxyMunitionMap munitions;
    Parser aParser;
    proxyUnitsMap deadUnits;
    proxyMunitionMap obsoleteMunitions;
    proxyObjectsMap brokenObjects;
    std::mutex aMutex;
 public :
    //--------------------------------------------------------------------------
    ProxyGame(petitions_t& petitions);
    //--------------------------------------------------------------------------
    ~ProxyGame();
    //--------------------------------------------------------------------------
    //**************************************************************************
    // COMMUNICATIONS
    //**************************************************************************
    //--------------------------------------------------------------------------
    void getModel();
    //--------------------------------------------------------------------------
    void getInitialModel();
    //--------------------------------------------------------------------------
    void receiveModel(std::string parsedModel);
    //--------------------------------------------------------------------------
    //**************************************************************************
    // ADD THINGS TO MODEL
    //**************************************************************************
    //--------------------------------------------------------------------------
    void addMunition(ProxyMunition& aMunition);
    //--------------------------------------------------------------------------
    proxyMunitionMap& getMunitions();
    //--------------------------------------------------------------------------
    void addTerritory(ProxyTerritories& aTerritory);
    //--------------------------------------------------------------------------
    proxyTerritoriesMap& getTerritories();
    //--------------------------------------------------------------------------
    void addObject(ProxyObject& anObject);
    //--------------------------------------------------------------------------
    proxyObjectsMap& getObjects();
    //--------------------------------------------------------------------------
    void addUnit(ProxyUnit& aUnit);
    //--------------------------------------------------------------------------
    proxyUnitsMap& getUnits();
    //--------------------------------------------------------------------------
    //**************************************************************************
    // CREATE UNITS AND PLAYER
    //**************************************************************************
    //--------------------------------------------------------------------------
    void createPlayer(size_t idTeam);
    //--------------------------------------------------------------------------
    void createRobotGrunt(size_t idBuilding);
    //--------------------------------------------------------------------------
    void createRobotLaser(size_t idBuilding);
    //--------------------------------------------------------------------------
    void createRobotTough(size_t idBuilding);
    //--------------------------------------------------------------------------
    void createRobotSniper(size_t idBuilding);
    //--------------------------------------------------------------------------
    void createRobotPyro(size_t idBuilding);
    //--------------------------------------------------------------------------
    void createRobotPsycho(size_t idBuilding);
    //--------------------------------------------------------------------------
    void createVehicleMML(size_t idBuilding);
    //--------------------------------------------------------------------------
    void createVehicleHeavyTank(size_t idBuilding);
    //--------------------------------------------------------------------------
    void createVehicleLightTank(size_t idBuilding);
    //--------------------------------------------------------------------------
    void createVehicleMediumTank(size_t idBuilding);
    //--------------------------------------------------------------------------
    void createVehicleJeep(size_t idBuilding);
    //--------------------------------------------------------------------------
    //**************************************************************************
    // MOVE AND ATTACK UNITS AND OBJECTS
    //**************************************************************************
    //--------------------------------------------------------------------------
    void moveUnitTo(uint32_t x, uint32_t y, size_t idUnit);
    //--------------------------------------------------------------------------
    void attackUnit(size_t idShooter, size_t idTarget);
    //--------------------------------------------------------------------------
    void attackObject(size_t idShooter, size_t idTarget);
    //--------------------------------------------------------------------------
    void update();
    //--------------------------------------------------------------------------
    void setMapDimensions(uint32_t width, uint32_t height);
    //--------------------------------------------------------------------------
    //**************************************************************************
    // UNUSED UNITS, OBJECTS AND MUNITIONS AND COLLECT TRASH
    //**************************************************************************
    //--------------------------------------------------------------------------
    proxyObjectsMap& getBrokenObjects();
    //--------------------------------------------------------------------------
    proxyUnitsMap& getDeadUnits();
    //--------------------------------------------------------------------------
    proxyMunitionMap& getObsoleteMunitions();
    //--------------------------------------------------------------------------
    void unitDie(size_t id);
    //--------------------------------------------------------------------------
    void MunitionDie(size_t id);
    //--------------------------------------------------------------------------
    void objectDie(size_t id);
    //--------------------------------------------------------------------------
    void cleanProxyGame();
    //--------------------------------------------------------------------------
    void cleanMunitions();
    //--------------------------------------------------------------------------
    void cleanObjects();
    //--------------------------------------------------------------------------
    void cleanUnits();
    //--------------------------------------------------------------------------
    void checkNotUpdatedModel();
    //--------------------------------------------------------------------------
 private :
    //--------------------------------------------------------------------------
    void killUnit(size_t id);
    //--------------------------------------------------------------------------
    void killMunition(size_t id);
    //--------------------------------------------------------------------------
    void killObject(size_t id);
    //--------------------------------------------------------------------------

};
//------------------------------------------------------------------------------
#endif  // PROXY_GAME_H
