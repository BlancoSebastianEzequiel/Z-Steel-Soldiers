// "Copyright [2017] <Copyright SebastianBlanco>"
//------------------------------------------------------------------------------
#include <vector>
#include <cmath>
#include <iostream>
#include "node.h"
#include "../maps/map.h"
#include "../objects/object.h"
#include "../units/unit.h"
#include "../territories/territories.h"
//------------------------------------------------------------------------------
//------------------------------------------------------------------------------
// NODE CONSTRUCTOR
//------------------------------------------------------------------------------
Node::Node(uint32_t x, uint32_t y): x(x), y(y) {
    infiniteCost = 99999999999999;
    anObject = NULL;
    hasAnObject = false;
    territory = nullptr;
}
//------------------------------------------------------------------------------
// NODE DESTRUCTOR
//------------------------------------------------------------------------------
Node::~Node() {}
//------------------------------------------------------------------------------
// OPERATOR ==
//------------------------------------------------------------------------------
bool Node::operator==(const Node& otherNode)const {
    return (x == otherNode.x && y == otherNode.y);
}
//------------------------------------------------------------------------------
// OPERATOR !=
//------------------------------------------------------------------------------
bool Node::operator!=(const Node& otherNode)const {
    return (x != otherNode.x || y != otherNode.y);
}
//------------------------------------------------------------------------------
// OPERATOR ()
//------------------------------------------------------------------------------
void Node::operator()(uint32_t x, uint32_t y) {
    this->x = x;
    this->y = y;
}
//------------------------------------------------------------------------------
// GET ADJACENT
//------------------------------------------------------------------------------
float Node::getGroundFactor()const {
    return groundFactor;
}
//------------------------------------------------------------------------------
// GET ADJACENT
//------------------------------------------------------------------------------
const std::vector<Node*>& Node::getAdjacent() const {
    return adjacent;
}
//------------------------------------------------------------------------------
// ADD ADJACENT
//------------------------------------------------------------------------------
void Node::addAdjacent(const Map& aMap) {
    aMap.addAdjacentTo(*this);
}
//------------------------------------------------------------------------------
// ADD GROUND OBJECT
//------------------------------------------------------------------------------
void Node::addGroundObject(Object* anObjectToAdd) {
    anObject = anObjectToAdd;
    hasAnObject = true;
}
//------------------------------------------------------------------------------
// DISTANCE TO
//------------------------------------------------------------------------------
double Node::distanceTo(const Node& aNode) const {
    int dx = abs(static_cast<int>(aNode.x - x));
    int dy = abs(static_cast<int>(aNode.y - y));
    return sqrt(pow(dx, 2) + pow(dy, 2));
}
//------------------------------------------------------------------------------
// HAS A GROUND OBJECT
//------------------------------------------------------------------------------
bool Node::hasAGroundObject() const {
    return hasAnObject;
}
//------------------------------------------------------------------------------
// GET GROUND OBJECT
//------------------------------------------------------------------------------
const Object* Node::getGroundObject() const {
    return anObject;
}
//------------------------------------------------------------------------------
// ADD TERRITORY
//------------------------------------------------------------------------------
void Node::addTerritory(const Territories &aTerritory) {
    territory = &aTerritory;
}
//------------------------------------------------------------------------------
// GET ID TERRITORY
//------------------------------------------------------------------------------
size_t Node::getIdTerritory() const {
    return territory->getId();
}
//------------------------------------------------------------------------------
// GET PLAYER
//------------------------------------------------------------------------------
const Player* Node::getOwner() const {
    if (territory == nullptr) {
        throw Exception(
                "The territory pointer of the node: (%u, &u) is null\n", x, y);
    }
    return territory->getOwner();
}
//------------------------------------------------------------------------------
// GET X
//------------------------------------------------------------------------------
const uint32_t Node::getX() const {
    return x;
}
//------------------------------------------------------------------------------
// GET Y
//------------------------------------------------------------------------------
const uint32_t Node::getY() const {
    return y;
}
//------------------------------------------------------------------------------
// GET TYPE
//------------------------------------------------------------------------------
std::string Node::getType() {
    return type;
}
//------------------------------------------------------------------------------
